

% Extracts and saves a field from each file


fnarr{1} = 'fb0s_onlybase';
fnarr{2} = 'fb1s_onlyPSP';
fnarr{3} = 'fb2s_det_PSPs';
fnarr{4} = 'fb4s_stoch_PSPs';
fnarr{5} = 'fb5s_det_PSPs';
fnarr{6} = 'fb6s_bstoch_PSPs';
fnarr{7} = 'fb7s_bdet_PSPs';
fnarr{8} = 'fb8s_bstochPSP_m';
fnarr{9} = 'fb8s_bstochPSP_m2';

fnarr{10} = 'fb0s_balance_first_try';
fnarr{11} = 'fb3s_fix_GABAB';
fnarr{12} = 'fb19_w2f_all';

fnarr{13} = 'fb0s_onlyion';
fnarr{14} = 'fb1s_stoch';
fnarr{15} = 'fb2s_det';
fnarr{16} = 'fb3sonly_stoch';
fnarr{17} = 'fb4sonly_det';

fnarr{18} = 'fb0s_base_m50m45';
fnarr{19} = 'fb0s_base_m45m45';
fnarr{20} = 'fb0s_base_m40m40';
fnarr{21} = 'fb0s_base_m35m35';

fnarr{22} = 'acsf';


fnarr{21} = 'fb0s_ap62';
fnarr{22} = 'fb0s_ap62_det';
fnarr{23} = 'fb0s_ap62_det_soma';
fnarr{24} = 'fb0s_ap62_soma';
fnarr{25} = 'fb0s_ap92';
fnarr{26} = 'fb0s_ap92_det';
fnarr{27} = 'fb0s_ap92_det_soma';
fnarr{28} = 'fb0s_ap92_soma';
fnarr{29} = 'fb0s_bas12';
fnarr{30} = 'fb0s_bas12_det';
fnarr{31} = 'fb0s_bas12_det_soma';
fnarr{32} = 'fb0s_bas12_soma';


fnarr{33} = 'ic1acsf.txt';
fnarr{34} = 'ic1syngap.txt';
fnarr{35} = 'ic1syn.txt';
fnarr{36} = 'ic1washout.txt';
fnarr{37} = 'ic2acsf.txt';
fnarr{38} = 'ic2EC.txt';
fnarr{39} = 'ic2syngap.txt';
fnarr{40} = 'ic2syn.txt';
fnarr{41} = 'ic2washout.txt';
fnarr{42} = 'ic3acsf.txt';
fnarr{43} = 'ic3syngap.txt';
fnarr{44} = 'ic3syn.txt';
fnarr{45} = 'ic3washout.txt';
fnarr{46} = 'ic4acsf.txt';
fnarr{47} = 'ic4syngap.txt';
fnarr{48} = 'ic4syn.txt';
fnarr{49} = 'ic4washout.txt';

fnarr{50} = 'p1acsf.mat';
fnarr{51} = 'p1syngap.txt';
fnarr{52} = 'p1syn.txt';
fnarr{53} = 'p1washout.txt';
fnarr{54} = 'p2acsf.txt';
fnarr{55} = 'p2EC.txt';
fnarr{56} = 'p2syngap.txt';
fnarr{57} = 'p2syn.txt';
fnarr{58} = 'p2washout.txt';
fnarr{59} = 'p3acsf.txt';
fnarr{60} = 'p3syngap.txt';
fnarr{61} = 'p3syn.txt';
fnarr{62} = 'p3washout.txt';
fnarr{63} = 'p4acsf.txt';
fnarr{64} = 'p4syngap.txt';
fnarr{65} = 'p4syn.txt';
fnarr{66} = 'p4washout.txt';


fnarr{67} = 'ic5acsf.txt';
fnarr{68} = 'ic5gapsyn.txt';
fnarr{69} = 'ic5gap.txt';
fnarr{70} = 'ic5washout.txt';
fnarr{71} = 'ic6acsf.txt';
fnarr{72} = 'ic6gapsyn.txt';
fnarr{73} = 'ic6gap.txt';
fnarr{74} = 'ic6washout.txt';
fnarr{75} = 'ic7acsf.txt';
fnarr{76} = 'ic7gapsyn.txt'
fnarr{77} = 'ic7gap.txt';
fnarr{78} = 'ic7washout.txt';
fnarr{79} = 'p5acsf.txt';
fnarr{80} = 'p5gapsyn.txt';
fnarr{81} = 'p5gap.txt';
fnarr{82} = 'p5washout.txt';
fnarr{83} = 'p6acsf.txt';
fnarr{84} = 'p6gapsyn.txt';
fnarr{85} = 'p6gap.txt';
fnarr{86} = 'p6washout.txt';
fnarr{87} = 'p7acsf.txt';
fnarr{88} = 'p7gapsyn.txt';
fnarr{89} = 'p7gap.txt';
fnarr{90} = 'p7washout.txt';



fnarr{91} = 'fb5s_stoch_noAMPA';
fnarr{92} = 'fb5sb_stoch_defaulttest';

fnarr{93} = 'fb0_onlyion'
fnarr{94} = 'fb1s_stoch'
fnarr{95} = 'fb2s_det'
fnarr{96} = 'fb3sonly_stoch'
fnarr{97} = 'fb4sonly_det'


fnarr{98} = 'ic8acsf.txt';
fnarr{99} = 'ic8gapsyn.txt';
fnarr{100} = 'ic8gap.txt';
fnarr{101} = 'ic8washout.txt';
fnarr{102} = 'ic9acsf.txt';
fnarr{103} = 'ic9gapsyn.txt';
fnarr{104} = 'ic9gap.txt';
fnarr{105} = 'ic9washout.txt';
fnarr{106} = 'p8acsf.txt';
fnarr{107} = 'p8gapsyn.txt';
fnarr{108} = 'p8gap.txt';
fnarr{109} = 'p8washout.txt';
fnarr{110} = 'p9acsf.txt';
fnarr{111} = 'p9gapsyn.txt';
fnarr{112} = 'p9gap.txt';
fnarr{113} = 'p9washout.txt';



fnarr{114} = 'fb0_onlyion1x';
fnarr{115} = 'fb0_onlyion2x';
fnarr{116} = 'fb0_onlyion4x';

fnarr{117} = 'fb0_onlyion1xNak';
fnarr{118} = 'fb0_onlyion2xNak';
fnarr{119} = 'fb0_onlyion4xNak';


fnarr{120} = 'fb0_onlyion_slowCa';
fnarr{121} = 'fb0_onlyion_skinner';



fnarr{122} = 'fb0_skinner2x';
fnarr{123} = 'fb0_skinner4x';
fnarr{124} = 'fb0_skinner8x';


fnarr{125} = 'fb0s_noexec';
fnarr{126} = 'fb0s_noinh';
fnarr{127} = 'fb1s_stoch';

fnarr{128} = 'fb0_inj4em12';
fnarr{129} = 'fb2s_stochpsd';



format compact;
datastart = 5500; % AFter the PID is finished...
downsamp = 4;
plotting = 1;



for i = 129:129
    i
    fn = fnarr{i};
    if ~(isempty(fn))

        data_orig = load (fn);

        data_orig_start = data_orig(1:datastart,:);
        s = data_orig(datastart+1:end,:);
        s = downsample(s,downsamp);


        [jcs spk] = spikinator_dav3(s(:,2),2000,15,0, 0, 0.5, 0.2,500);
        jcs = [ s(1:length(jcs),1) jcs ];
        data = [data_orig_start; jcs];


        
        if ~(length(s(:,2)) == length(jcs))
            fprintf ('Spikes removed from trace %d \n',i)
            if (plotting)
                figure; plotarr([data_orig_start; s]);
                hold on; plotarr(data, 'r');
                hold on; plotarr(data_orig,'g');
                legend ('original','despiked', 'original');
            end
        end
        
        channelnames = 'Vm';
%         fn = fn(1:(findstr(fn, '.txt')-1));
        save (fn, 'data', 'channelnames');
    end
end
